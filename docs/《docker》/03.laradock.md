---
title: Laradock
date: 2022-04-13 14:18:12
permalink: /tools/docker/Laradock/
titleTag: 原创
categories:
  - docker
  - laradock
tags:

---
## setting
- .env
  ```
    TZ="Asia/Shanghai"
    PHP_VERSION=8.1
    CHANGE_SOURCE=true # 切换中国源

    # workspace 设置
    WORKSPACE_COMPOSER_GLOBAL_INSTALL=true    //workspace全局安装composer
    WORKSPACE_COMPOSER_REPO_PACKAGIST=https://mirrors.aliyun.com/composer/
    WORKSPACE_NVM_NODEJS_ORG_MIRROR=https://npmmirror.com/mirrors/node
    WORKSPACE_INSTALL_LARAVEL_INSTALLER=true    //workspace  laravel安装器
    WORKSPACE_TIMEZONE="Asia/Shanghai"   //设置workspace时区,默认是UTC
    WORKSPACE_INSTALL_SUPERVISOR=true // 开启laravel队列需要用到 [Supervisor](#supervisor), Linux 操作系统的进程监视器。  查看本文档的 Supervisor 配置
    WORKSPACE_INSTALL_SWOOLE=true && PHP_FPM_INSTALL_SWOOLE=true // 启动Swoole 加速 laravel
    PHP_WORKER_INSTALL_SWOOLE=true
  ```
- [MySql](../05.工具/08.mysql.md)
  默认账号密码有两个： root default 
  - mysql -uroot -proot
  - mysql -udefault -psecret
- s

## 添加新项目
- 添加站点
  - 查看docker的IP地址 
      docker-machine env
  - hosts设置（bridge 模式时，IP地址为127.0.0.1）：
      10.75.0.1  xx.xxx.xx # 容器内部访问需要设定，不然无法访问
      127.0.0.1  xx.xxx.xx # 容器外部访问需要设定，不然无法访问
  - nginx 设置
      - sites设置
          - server_name laravel.test;
          - root /var/www/laravel/public;
  - 重启nginx 容器
  - 进入mysql 容器
    - 创建 mysql 账号
    - 创建数据库
    - 账号授权、刷新权限
- 修改文件的权限 chmod 755
  ```sh
  chmod 777 -R storage bootstrap/cache
  ```
- 切换root用户 sudo -i
- docker-machine command not found
    https://github.com/docker/machine/releases

## Enter a Container#
Run commands in a running Container.

1 - First list the currently running containers with docker ps

2 - Enter any container using:

```sh
docker-compose exec {container-name} bash
```
Example: enter MySQL container

```sh
docker-compose exec mysql bash
```

Example: enter to MySQL prompt within MySQL container
```sh
docker-compose exec mysql mysql -udefault -psecret

```

Note: You can add --user=laradock to have files created as your host’s user. Example:
```sh

docker-compose exec --user=laradock workspace bash
```

3 - To exit a container, type exit.

## start container
```sh
docker-compose up -d nginx redis mysql
```


## Supervisor
在 mydock/php-worker 中配置 supervisor。

在supervisord.d中有示例文件，根据示例文件创建自己的配置文件，如 web-worker.conf 。
