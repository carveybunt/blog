---
title: 邮件指南
date: 2023-03-26 14:05:38
permalink: /laravel/email/guide/
titleTag: 原创
categories: 
  - LARAVEL
tags: 
author: 
  name: 诚城
  link: https://www.carveybunt.cn/user/profile/
---

## 配置

`.env` 文件下设置

### Gmail

Gmail 很慢……

```php
MAIL_MAILER=smtp
MAIL_HOST=smtp.gmail.com
MAIL_PORT=587
MAIL_USERNAME=carveybunt@gmail.com
MAIL_PASSWORD=jscjjjyeovbhbtde
MAIL_ENCRYPTION=tls
MAIL_FROM_ADDRESS="carveybunt@gmail.com"
MAIL_FROM_NAME="${APP_NAME}"
```

配置完成后，一定要执行： `php artisan config:cache`

### QQ企业邮箱

```env
MAIL_MAILER=smtp
MAIL_HOST=smtp.exmail.qq.com
MAIL_PORT=465
MAIL_USERNAME=lanxiaobai@vipnol.com
MAIL_PASSWORD=A123123a
MAIL_ENCRYPTION=ssl
MAIL_FROM_ADDRESS="lanxiaobai@vipnol.com"
MAIL_FROM_NAME="${APP_NAME}"

```

配置完成后，一定要执行： `php artisan config:cache`

### QQ邮箱

```php
MAIL_MAILER=smtp
MAIL_HOST=smtp.qq.com
MAIL_PORT=465
MAIL_USERNAME=carveybunt@qq.com
MAIL_PASSWORD=osvapfoksbdikgpx
MAIL_ENCRYPTION=ssl
MAIL_FROM_ADDRESS="carveybunt@qq.com"
MAIL_FROM_NAME="${APP_NAME}"
```

配置完成后，一定要执行： `php artisan config:cache`

## 邮件模型

```sh
php artisan make:mail ValidateMail
```

```php
<?php

namespace App\Mail;

use Illuminate\Bus\Queueable;
use Illuminate\Contracts\Queue\ShouldQueue;
use Illuminate\Mail\Mailable;
use Illuminate\Mail\Mailables\Content;
use Illuminate\Mail\Mailables\Envelope;
use Illuminate\Queue\SerializesModels;

class ValidateEmail extends Mailable
{
    use Queueable, SerializesModels;

    public $mailData;

    public function __construct($mailDate)
    {
        $this->mailData = $mailDate;
    }

    /**
     * Get the message envelope.
     * 获取邮件信封。
     */
    public function envelope(): Envelope
    {
        return new Envelope(
//            subject: 'ValidateEmail',
            subject: env('APP_NAME').' '.__('user.ValidateEmail'),// 国际化
        );
    }

    /**
     * Get the message content definition.
     */
    public function content(): Content
    {
        return new Content(
            view: 'emails.validate', // 在 resources/views 目录下创建对应的文件
        );
    }

    /**
     * Get the attachments for the message.
     *
     * @return array<int, \Illuminate\Mail\Mailables\Attachment>
     */
    public function attachments(): array
    {
        return [];
    }
}

```

## 邮件视图

`resources/views/emails/validate.blade.php`

```php
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="with=device-width, initial-scale=1">
    <title>邮箱验证</title>
</head>
<body>
    <h1>{{ $mailData['title'] }}</h1>
    <p>{{ $mailData['body'] }}</p>
</body>
</html>

```

## 使用

在控制器中使用 [邮件模型](#邮件模型) 。

```php
use Illuminate\Support\Facades\Mail;
use App\Mail\ValidateEmail;

public function sendEmail(){
    $code = 123;
    $mailData = [
        'title'=>'欢迎使用 学海',
        'body'=>'注册验证码'.$code
    ];
    Mail::to('376377656@qq.com')->send(new ValidateEmail($mailData));
    dd(1);
}
```
