---
title: artisan 命令
date: 2022-06-13 21:39:02
permalink: /laravel/artisan/
titleTag: 原创
categories: 
  - 后端
  - 框架
  - laravel
tags: 
  - null
author: 
  name: 诚城
  link: https://github.com/carveybunt
---
## 修改默认 stub 自定义 aritsan mkae 命令

```php
php artisan stub:publish

```

命令将在 `stubs` 目录中创建所有 `php artisan make` 的 `stub` 模板文件。

如自定义 request :

```php
<?php

namespace {{ namespace }};

use Illuminate\Foundation\Http\FormRequest;

class {{ class }} extends BaseRequest
{
    public function rules()
    {
        switch($this->method()) {
            case 'POST': //资源路由的  store
                return [
                    'name' => ['bail','required','string','max:10'],
                ];
                break;
            default:
                break;
        }

//        return [
//            'email' => 'required|email|unique:users|max:255',
//        ];
    }

    public function messages()
    {
        return [
//            'captcha' => '验证码错误',
        ];
    }
    //使用语言包后，那些不会翻译的英语内容，在这定义
    public function attributes()
    {
        return [
//            'code' => '验证码',
        ];
    }
}
```

## 创建自定义命令

```php
php artisan make:command xxx
```

命令将在 `app/Console/Commands` 目录中创建一个新的命令类。

## 在 php 中使用 artisan

```php
Artisan::call('命令');

Artisan::call('passport:install --uuids'); // 执行 php artisan migrate:refresh --seed 记得回车一下
```

## 在字符界面显示信息

在 `seeder` 中可以直接调用 `$this->command` 来实现信息的输出。使用 `line`(无底色) ，`info`(绿字)，`comment`(黄字)，`question`(浅蓝背景色) 和 `error`(红底白字) 方法，发送输出到控制台。

```php
$this->command->info("高等数学 章节 迁移完成");
// 输出单行空白...
$this->command->newLine();

// 输出三行空白...
$this->command->newLine(3);
```

### 进度条

```php
$bar = $this->command
    ->getOutput()
    ->createProgressBar(count($math, 1)); // 计算进度条总量
$bar->setMessage("高等数学 章节 迁移开始");
$bar->start(); // 进度条开始
$bar->setMessage("高等数学 章节 迁移……");
$this->deepInsert($math, $hightMath->id, $bar);
$bar->finish(); // 进度条结束
$this->command->newLine(); // 换行
$this->command->info("高等数学 章节 迁移完成");
$this->command->newLine(); // 换行

public function deepInsert(
    array $data,
    string $sId,
    $bar,
    string $pId = null
) {
    foreach ($data as $d) {
        $res = SubjectPoint::firstOrCreate([
            "subject_id" => $sId,
            "parent_id" => $pId ?? null,
            "title" => $d["title"],
            "sort" => $d["sort"] ?? 10,
        ]);
        $bar->advance(); // 增加进度条
        if (array_key_exists("children", $d) && $res) {
            $this->deepInsert($d["children"], $sId, $bar, $res->id);
        }
    }
}
```
